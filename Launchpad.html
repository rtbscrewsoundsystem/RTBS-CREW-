<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Launchpad Pro Web - Lightshow & Sampler</title>
    <style>
        :root {
            --bg: #050505;
            --chassis: #1a1a1b;
            --pad-empty: #313131;
            --accent: #00ff55;
        }

        body {
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            gap: 20px;
        }

        /* --- Launchpad Visual --- */
        .lp-chassis {
            background: var(--chassis);
            padding: 15px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(8, 45px) 50px;
            grid-template-rows: 50px repeat(8, 45px);
            gap: 6px;
            border: 4px solid #000;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        .cell {
            background: var(--pad-empty);
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.1s, box-shadow 0.1s;
        }

        .round-btn { border-radius: 50%; background: #444; width: 35px; height: 35px; align-self: center; justify-self: center; }

        /* Estados de Luz Especiales */
        .hit-flash { background: white !important; box-shadow: 0 0 20px white !important; }
        .looping { animation: pulse 1s infinite alternate; }
        @keyframes pulse { from { opacity: 1; } to { opacity: 0.5; } }

        /* --- Panel de Control --- */
        .side-panel {
            background: #1e1e22;
            padding: 20px;
            border-radius: 12px;
            width: 320px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #333;
        }

        .pad-grid-mini {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            background: #000;
            padding: 8px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .mini-pad {
            aspect-ratio: 1;
            background: #444;
            border-radius: 2px;
            cursor: pointer;
        }

        .mini-pad.selected { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
        .mini-pad.has-audio { border: 1px solid #ff2255; }

        .control-group { margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        label { display: block; font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 5px; }
        input, select, button { width: 100%; padding: 8px; background: #2a2a2e; color: white; border: 1px solid #444; border-radius: 4px; box-sizing: border-box; }
        button { background: var(--accent); color: black; font-weight: bold; border: none; cursor: pointer; margin-top: 5px; }
        
        .lightshow-btn { background: #2255ff; color: white; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="lp-chassis" id="launchpad">
        <div style="grid-column: 1/5; color: #444; font-size: 10px; font-weight: bold;">WEB PAD PRO v2</div>
        </div>

    <div class="side-panel">
        <h3>CONFIGURADOR</h3>
        
        <div class="control-group">
            <label>1. Toca un pad en la rejilla o aquí:</label>
            <div class="pad-grid-mini" id="miniGrid"></div>
            <div id="selInfo" style="font-size: 12px; color: var(--accent);">Pad seleccionado: Ninguno</div>
        </div>

        <div class="control-group">
            <label>2. Cargar Audio</label>
            <input type="file" id="audioInput" accept="audio/*">
            <select id="playMode" style="margin-top:5px;">
                <option value="sample">Sampler (Un disparo)</option>
                <option value="loop">Loop (Repetitivo)</option>
            </select>
        </div>

        <div class="control-group">
            <label>3. Efectos de Sonido</label>
            <div style="display:flex; gap:10px;">
                <div style="flex:1">
                    <label>Volumen</label>
                    <input type="range" id="gainSlider" min="0" max="2" step="0.1" value="1">
                </div>
                <div style="flex:1">
                    <label>Filtro</label>
                    <input type="range" id="filterSlider" min="100" max="5000" value="5000">
                </div>
            </div>
        </div>

        <div class="control-group">
            <label>4. Animaciones de Luz</label>
            <button class="lightshow-btn" onclick="triggerLightshow('explote')">Efecto Explosión</button>
            <button class="lightshow-btn" onclick="triggerLightshow('wave')">Onda Cruzada</button>
        </div>
    </div>

<script>
    const lp = document.getElementById('launchpad');
    const miniGrid = document.getElementById('miniGrid');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    const pads = {}; // Datos de cada pad
    let selectedId = null;
    let midiOut = null;

    // --- INICIALIZACIÓN ---
    for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
            const id = `p-${r}-${c}`;
            pads[id] = { buffer: null, mode: 'sample', gain: 1, filter: 5000, note: (r*16)+c, r, c };

            // Pad Principal
            const div = document.createElement('div');
            div.className = 'cell';
            div.id = id;
            div.onclick = () => handlePadClick(id);
            lp.appendChild(div);

            // Pad Miniatura
            const mini = document.createElement('div');
            mini.className = 'mini-pad';
            mini.id = `mini-${id}`;
            mini.onclick = () => handlePadClick(id);
            miniGrid.appendChild(mini);
        }
        const rb = document.createElement('div');
        rb.className = 'cell round-btn';
        lp.appendChild(rb);
    }

    function handlePadClick(id) {
        // Actualizar UI de selección
        if(selectedId) {
            document.getElementById(selectedId).classList.remove('selected');
            document.getElementById(`mini-${selectedId}`).classList.remove('selected');
        }
        selectedId = id;
        document.getElementById(`mini-${id}`).classList.add('selected');
        document.getElementById('selInfo').innerText = `Pad: ${id} seleccionado`;
        
        // Cargar valores al panel
        document.getElementById('playMode').value = pads[id].mode;
        document.getElementById('gainSlider').value = pads[id].gain;
        document.getElementById('filterSlider').value = pads[id].filter;
        
        // Disparar sonido
        triggerPad(id);
    }

    // --- AUDIO ---
    document.getElementById('audioInput').onchange = async (e) => {
        if(!selectedId) return alert("Selecciona un pad primero");
        const file = e.target.files[0];
        const buffer = await audioCtx.decodeAudioData(await file.arrayBuffer());
        pads[selectedId].buffer = buffer;
        document.getElementById(`mini-${selectedId}`).classList.add('has-audio');
    };

    async function triggerPad(id, fromMidi = false) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const p = pads[id];
        const el = document.getElementById(id);

        // Animación visual inmediata (Flash)
        el.classList.add('hit-flash');
        setTimeout(() => el.classList.remove('hit-flash'), 100);
        sendMidi(p.note, 60); // Luz verde en hardware

        if (!p.buffer) return;

        // Si es loop y ya suena, parar
        if(p.activeSource) {
            p.activeSource.stop();
            p.activeSource = null;
            el.classList.remove('looping');
            sendMidi(p.note, 0);
            return;
        }

        const source = audioCtx.createBufferSource();
        source.buffer = p.buffer;
        
        const gain = audioCtx.createGain();
        gain.gain.value = p.gain;
        
        const filter = audioCtx.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.value = p.filter;

        source.connect(filter).connect(gain).connect(audioCtx.destination);
        
        if(p.mode === 'loop') {
            source.loop = true;
            p.activeSource = source;
            el.classList.add('looping');
            sendMidi(p.note, 15); // Rojo para loops
        }
        
        source.start();
        if(p.mode !== 'loop') {
            source.onended = () => sendMidi(p.note, 0);
        }
    }

    // --- LIGHTSHOW (ANIMACIONES DE LUCES) ---
    function triggerLightshow(type) {
        if(type === 'explote') {
            // Animación de expansión desde el centro
            for(let id in pads) {
                const p = pads[id];
                const dist = Math.abs(p.r - 3.5) + Math.abs(p.c - 3.5);
                setTimeout(() => {
                    visualFlash(id, 'blue');
                }, dist * 100);
            }
        } else if(type === 'wave') {
            // Onda de izquierda a derecha
            for(let id in pads) {
                const p = pads[id];
                setTimeout(() => {
                    visualFlash(id, 'purple');
                }, p.c * 100);
            }
        }
    }

    function visualFlash(id, color) {
        const el = document.getElementById(id);
        const original = el.style.background;
        el.style.background = color;
        sendMidi(pads[id].note, 45); // Color naranja/púrpura en HW
        setTimeout(() => {
            el.style.background = original;
            sendMidi(pads[id].note, 0);
        }, 200);
    }

    // --- MIDI ---
    if (navigator.requestMIDIAccess) {
        navigator.requestMIDIAccess().then(midi => {
            midiOut = Array.from(midi.outputs.values())[0];
            for (let input of midi.inputs.values()) {
                input.onmidimessage = (m) => {
                    const [status, note, vel] = m.data;
                    if (status === 144 && vel > 0) {
                        // Encontrar pad por nota MIDI
                        for(let id in pads) {
                            if(pads[id].note === note) triggerPad(id, true);
                        }
                    }
                };
            }
        });
    }

    function sendMidi(note, color) {
        if (midiOut) midiOut.send([144, note, color]);
    }

    // Actualizar settings en tiempo real
    document.getElementById('playMode').onchange = (e) => pads[selectedId].mode = e.target.value;
    document.getElementById('gainSlider').oninput = (e) => pads[selectedId].gain = e.target.value;
    document.getElementById('filterSlider').oninput = (e) => pads[selectedId].filter = e.target.value;

</script>
</body>
</html>
